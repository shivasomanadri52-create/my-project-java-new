<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Smart Hospital Management</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{--primary:#0077cc;--secondary:#00aaff;--bg:#eef6fb;--card:#fff;--text:#222;}
body.dark{--primary:#111;--secondary:#333;--bg:#0f0f0f;--card:#1e1e1e;--text:#eee;}
body{margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:var(--text);transition:0.4s;}
header{background:linear-gradient(to right,var(--primary),var(--secondary));color:white;text-align:center;padding:25px;position:relative;box-shadow:0 4px 8px rgba(0,0,0,0.3);}
#themeToggle{position:absolute;top:15px;right:20px;background:white;color:var(--primary);border:none;border-radius:20px;padding:5px 10px;cursor:pointer;font-weight:bold;}
#clock{position:absolute;top:15px;left:20px;font-weight:bold;}
nav{display:flex;flex-wrap:wrap;justify-content:center;background:var(--card);border-bottom:1px solid #ccc;padding:10px;}
nav button{margin:5px 10px;padding:10px 20px;background-color:var(--primary);color:white;border:none;border-radius:20px;cursor:pointer;font-weight:bold;transition:0.3s;}
nav button:hover{background-color:var(--secondary);}
.container{max-width:400px;margin:60px auto;background:var(--card);padding:30px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.2);text-align:center;}
.hidden{display:none;}
.dashboard, section{max-width:900px;margin:40px auto;padding:20px;background:var(--card);border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
input,select,textarea{width:85%;padding:10px;margin:10px 0;border-radius:8px;border:1px solid #ccc;}
button{padding:10px 20px;border-radius:8px;border:none;background:var(--primary);color:#fff;cursor:pointer;font-weight:bold;transition:0.3s;}
button:hover{background:var(--secondary);}
.table{width:100%;border-collapse:collapse;margin-top:10px;}
.table th,.table td{border:1px solid #ccc;padding:8px;text-align:center;}
.table th{background:var(--primary);color:#fff;}
input[type="search"]{width:60%;padding:8px;margin:10px;}
canvas{background:#fff;margin:10px;border-radius:10px;padding:10px;}
.calendar{display:flex;flex-wrap:wrap;width:350px;margin:auto;}
.day{border:1px solid #ccc;width:14%;height:50px;display:flex;align-items:center;justify-content:center;cursor:pointer;margin:1px;border-radius:4px;}
.day:hover{background:var(--secondary);color:white;}
.toast{position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:10px 20px;border-radius:8px;display:none;}
</style>
</head>
<body>
<header>
  <h1>Ultimate Smart Hospital Management</h1>
  <button id="themeToggle">🌙</button>
  <div id="clock"></div>
</header>

<nav id="mainNav" class="hidden">
  <button onclick="showSection('dashboardSec')">Dashboard</button>
  <button onclick="showSection('patientSec')">Patients</button>
  <button onclick="showSection('tokenSec')">Tokens</button>
  <button onclick="showSection('medSec')">Medications</button>
  <button onclick="showSection('staffSec')">Staff</button>
  <button onclick="showSection('billingSec')">Billing</button>
  <button onclick="showSection('aiSec')">AI Doctor</button>
  <button onclick="showSection('appointmentSec')">Appointments</button>
</nav>

<div class="container" id="loginBox">
  <h2>Login</h2>
  <input type="text" id="loginUser" placeholder="Username">
  <input type="password" id="loginPass" placeholder="Password">
  <select id="loginRole">
    <option value="Admin">Admin</option>
    <option value="Doctor">Doctor</option>
    <option value="Receptionist">Receptionist</option>
  </select>
  <button onclick="login()">Login</button>
  <p>New user? <a href="#" onclick="showRegister()">Register</a></p>
</div>

<div class="container hidden" id="registerBox">
  <h2>Register</h2>
  <input type="text" id="regUser" placeholder="Username">
  <input type="password" id="regPass" placeholder="Password">
  <select id="regRole">
    <option value="Admin">Admin</option>
    <option value="Doctor">Doctor</option>
    <option value="Receptionist">Receptionist</option>
  </select>
  <button onclick="register()">Register</button>
  <p><a href="#" onclick="showLogin()">Back to Login</a></p>
</div>

<!-- DASHBOARD -->
<section id="dashboardSec" class="hidden dashboard">
  <h2>Dashboard Analytics</h2>
  <canvas id="patientsChart" height="150"></canvas>
  <canvas id="billingChart" height="150"></canvas>
  <canvas id="medsChart" height="150"></canvas>
</section>

<!-- Patients Section -->
<section id="patientSec" class="hidden dashboard">
  <h2>Patients</h2>
  <input type="text" id="pname" placeholder="Name">
  <input type="number" id="page" placeholder="Age">
  <input type="text" id="pgender" placeholder="Gender">
  <input type="text" id="pdisease" placeholder="Disease">
  <button onclick="addPatient()">Add Patient</button>
  <input type="search" id="searchPatient" placeholder="Search..." onkeyup="renderPatients()">
  <table class="table">
    <thead><tr><th>Token</th><th>Name</th><th>Age</th><th>Gender</th><th>Disease</th><th>Action</th></tr></thead>
    <tbody id="patientTable"></tbody>
  </table>
</section>

<!-- Tokens Section -->
<section id="tokenSec" class="hidden dashboard">
  <h2>Tokens</h2>
  <input type="text" id="tokenName" placeholder="Patient Name">
  <button onclick="generateToken()">Generate Token</button>
  <table class="table">
    <thead><tr><th>Token</th><th>Patient</th><th>Action</th></tr></thead>
    <tbody id="tokenTable"></tbody>
  </table>
</section>

<!-- Medications Section -->
<section id="medSec" class="hidden dashboard">
  <h2>Medications</h2>
  <input type="text" id="medPatient" placeholder="Patient Name">
  <input type="text" id="medName" placeholder="Medicine Name">
  <button onclick="addMed()">Add Medication</button>
  <table class="table">
    <thead><tr><th>Patient</th><th>Medicine</th><th>Action</th></tr></thead>
    <tbody id="medTable"></tbody>
  </table>
</section>

<!-- Staff Section -->
<section id="staffSec" class="hidden dashboard">
  <h2>Staff</h2>
  <input type="text" id="staffName" placeholder="Staff Name">
  <input type="text" id="staffRole" placeholder="Role">
  <button onclick="addStaff()">Add Staff</button>
  <table class="table">
    <thead><tr><th>Name</th><th>Role</th><th>Action</th></tr></thead>
    <tbody id="staffTable"></tbody>
  </table>
</section>

<!-- Billing Section -->
<section id="billingSec" class="hidden dashboard">
  <h2>Billing</h2>
  <input type="text" id="billPatient" placeholder="Patient Name">
  <input type="number" id="billAmount" placeholder="Amount">
  <button onclick="addBill()">Add Bill</button>
  <button onclick="exportBillsPDF()">Export PDF</button>
  <table class="table">
    <thead><tr><th>Patient</th><th>Amount</th><th>Action</th></tr></thead>
    <tbody id="billTable"></tbody>
  </table>
</section>

<!-- AI Doctor Section -->
<section id="aiSec" class="hidden dashboard">
  <h2>AI Doctor</h2>
  <input type="text" id="aiQuery" placeholder="Describe symptoms">
  <button onclick="askAI()">Ask AI</button>
  <p id="aiResponse" style="margin-top:15px;font-style:italic;"></p>
</section>

<!-- Appointment Scheduler Section -->
<section id="appointmentSec" class="hidden dashboard">
  <h2>Appointments Scheduler</h2>
  <input type="text" id="apptPatient" placeholder="Patient Name">
  <input type="date" id="apptDate">
  <button onclick="addAppointment()">Add Appointment</button>
  <div class="calendar" id="calendar"></div>
  <ul id="apptList"></ul>
</section>

<div class="toast" id="toast">Action Successful!</div>

<script>
// === THEME & CLOCK ===
document.getElementById("themeToggle").onclick=()=>{document.body.classList.toggle("dark");themeToggle.textContent=document.body.classList.contains("dark")?"☀️":"🌙";};
setInterval(()=>{clock.textContent=new Date().toLocaleString();},1000);

// === STORAGE FUNCTIONS ===
function getUsers(){return JSON.parse(localStorage.getItem("users"))||[];}
function setUsers(u){localStorage.setItem("users",JSON.stringify(u));}
function getPatients(){return JSON.parse(localStorage.getItem("patients"))||[];}
function setPatients(p){localStorage.setItem("patients",JSON.stringify(p));}
function getTokens(){return JSON.parse(localStorage.getItem("tokens"))||[];}
function setTokens(t){localStorage.setItem("tokens",JSON.stringify(t));}
function getMeds(){return JSON.parse(localStorage.getItem("meds"))||[];}
function setMeds(m){localStorage.setItem("meds",JSON.stringify(m));}
function getStaff(){return JSON.parse(localStorage.getItem("staff"))||[];}
function setStaff(s){localStorage.setItem("staff",JSON.stringify(s));}
function getBills(){return JSON.parse(localStorage.getItem("bills"))||[];}
function setBills(b){localStorage.setItem("bills",JSON.stringify(b));}
function getAppointments(){return JSON.parse(localStorage.getItem("appointments"))||[];}
function setAppointments(a){localStorage.setItem("appointments",JSON.stringify(a));}

// === LOGIN/REGISTER ===
function showRegister(){loginBox.classList.add("hidden");registerBox.classList.remove("hidden");}
function showLogin(){registerBox.classList.add("hidden");loginBox.classList.remove("hidden");}
function register(){let u=regUser.value,p=regPass.value,r=regRole.value;if(!u||!p)return alert("Fill all");let users=getUsers();if(users.find(x=>x.username===u))return alert("User exists!");users.push({username:u,password:p,role:r});setUsers(users);alert("Registered!");showLogin();}
function login(){let u=loginUser.value,p=loginPass.value,r=loginRole.value;let users=getUsers();let found=users.find(x=>x.username===u&&x.password===p&&x.role===r);if(!found)return alert("Invalid!");localStorage.setItem("sessionUser",JSON.stringify(found));mainNav.classList.remove("hidden");showSection('dashboardSec');updateDashboard();renderAll();}

// === NAVIGATION ===
function showSection(id){document.querySelectorAll('section').forEach(s=>s.classList.add("hidden"));document.getElementById(id).classList.remove("hidden");updateDashboard();renderAll();}

// === DASHBOARD CHARTS ===
let patientsChart,billingChart,medsChart;
function updateDashboard(){
  const patients=getPatients().length,bills=getBills().length,meds=getMeds().length;
  if(!patientsChart)patientsChart=new Chart(document.getElementById("patientsChart"),{type:'bar',data:{labels:['Patients'],datasets:[{label:'Total Patients',data:[patients],backgroundColor:'rgba(0,123,255,0.7)'}]}});
  else patientsChart.data.datasets[0].data=[patients];
  if(!billingChart)billingChart=new Chart(document.getElementById("billingChart"),{type:'bar',data:{labels:['Bills'],datasets:[{label:'Total Bills',data:[bills],backgroundColor:'rgba(255,99,132,0.7)'}]}});
  else billingChart.data.datasets[0].data=[bills];
  if(!medsChart)medsChart=new Chart(document.getElementById("medsChart"),{type:'bar',data:{labels:['Medications'],datasets:[{label:'Total Meds',data:[meds],backgroundColor:'rgba(255,206,86,0.7)'}]}});
  else medsChart.data.datasets[0].data=[meds];
  if(patientsChart)patientsChart.update();if(billingChart)billingChart.update();if(medsChart)medsChart.update();
}

// === PATIENT, TOKEN, MEDS, STAFF, BILLING, APPOINTMENT FUNCTIONS ===
// (Implement add/render/delete similar to previous JS code)

// === AI DOCTOR TTS ===
function askAI(){let q=aiQuery.value;if(!q)return;aiResponse.textContent="Analyzing...";let msg=`AI Suggestion: Check ${q.split(" ")[0]} related issues.`;setTimeout(()=>{aiResponse.textContent=msg;speechSynthesis.speak(new SpeechSynthesisUtterance(msg));},1000);}

// === EXPORT BILL PDF ===
function exportBillsPDF(){const { jsPDF } = window.jspdf;let doc=new jsPDF();let b=getBills();let y=10;doc.text("Hospital Billing Report",10,y);y+=10;b.forEach(rec=>{doc.text(`Patient: ${rec.patient} - Amount: ${rec.amount}`,10,y);y+=10;});doc.save("billing.pdf");}

// === AUTO LOAD ===
window.onload=()=>{if(localStorage.getItem("sessionUser")){mainNav.classList.remove("hidden");showSection('dashboardSec');}renderAll();}
function renderAll(){renderPatients();renderTokens();renderMeds();renderStaff();renderBills();renderAppointments();updateDashboard();}
</script>
</body>
</html>
